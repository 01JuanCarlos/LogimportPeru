---
import "../styles/global.css";
import Layout from "../layouts/Layout.astro";
import Navbar from "../components/navbar.astro";
import Footer from "../components/footer.astro";
---

<style>
    .btn-send {
        width: 143px;
        height: 49px;
        font-size: 16px;
        font-weight: 500;
        background: #e01f34;
        color: white;
        border: none;
        border-radius: 3px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: 0.3s;
    }
    .container-form {
        display: flex;
        justify-content: center;
        justify-items: center;
        flex-direction: column;
        align-content: center;
        align-items: center;
    }
    @media (max-width: 991px) {
        .container-form {
            margin-top: 92px !important;
        }
    }
</style>
<Layout>
    <Navbar />
    <div class="container container-form">
        <h1 class="text-center mb-2">Cotizaci√≥n Big Bag</h1>
        <p class="text-center text-header mb-4">
            En el siguiente formulario podr√° especificar las caracter√≠sticas del
            big bag que es de su inter√©s
        </p>
        <br />
        <br />

        <form
            id="cotizacionForm"
            method="POST"
            action="/api/brevo-submit"
            class="contact-form"
        >
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="empresa" class="form-label">Empresa:</label>
                    <input
                        type="text"
                        class="form-control"
                        id="empresa"
                        name="empresa"
                        required
                    />
                </div>
                <div class="col-md-6">
                    <label for="email" class="form-label"
                        >Correo Electr√≥nico:</label
                    >
                    <input
                        type="email"
                        class="form-control"
                        id="email"
                        name="email"
                        required
                    />
                </div>
                <div class="col-md-6">
                    <label for="rucdni_value" class="form-label">RUC/DNI:</label
                    >

                    <div class="input-group">
                        <select
                            class="form-select"
                            id="rucdni_type"
                            name="rucdni_type"
                            style="max-width: 110px;"
                        >
                            <option value="RUC" selected>RUC</option>
                            <option value="DNI">DNI</option>
                        </select>

                        <input
                            type="text"
                            class="form-control"
                            id="rucdni_value"
                            name="rucdni_value"
                            placeholder="Ingrese el n√∫mero"
                            required
                        />
                    </div>

                    <!-- ‚úî Error debajo del input -->
                    <p id="rucdni_error" class="text-danger small mt-1"></p>
                </div>

                <div class="col-md-6">
                    <label for="ciudad" class="form-label">Ciudad:</label>
                    <input
                        type="text"
                        class="form-control"
                        id="ciudad"
                        name="ciudad"
                    />
                </div>
                <div class="col-md-6">
                    <label for="contacto" class="form-label"
                        >Persona de contacto:</label
                    >
                    <input
                        type="text"
                        class="form-control"
                        id="contacto"
                        name="contacto"
                    />
                </div>
                <div class="col-md-6">
                    <label for="telefono" class="form-label">Tel√©fono:</label>
                    <input
                        type="tel"
                        class="form-control"
                        id="telefono"
                        name="telefono"
                    />
                </div>
            </div>

            <div class="mb-4 mt-3">
                <label for="mensaje">Mensaje:</label>
                <textarea
                    id="mensaje"
                    class="form-control"
                    name="mensaje"
                    ></textarea>
            </div>
            <hr />
            <h5 class="mb-3">ESPECIFICACIONES T√âCNICAS DEL BIG BAG</h5>
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="capacidad" class="form-label"
                        >Capacidad de carga:</label
                    >
                    <div class="input-group">
                        <input
                            type="number"
                            class="form-control"
                            id="capacidad"
                            name="capacidad"
                            step="1"
                            required
                        />
                        <span class="input-group-text">Kg</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label for="material" class="form-label"
                        >Material a cargar:</label
                    >
                    <input
                        type="text"
                        class="form-control"
                        id="material"
                        name="material"
                    />
                </div>
            </div>

            <hr class="mt-4" />

            <h5 class="mb-3">DISE√ëO DEL BIG BAG</h5>
            <div class="row">
                <div class="col-md-3 design-option">
                    <img
                        src="../product-1.jpg"
                        alt="Big Bag Cielo Abierto - Fondo Plano"
                        style="max-width: 9rem;padding: 10px;"
                    />
                    <div class="form-check d-flex">
                        <input
                            class="form-check-input me-2"
                            type="radio"
                            name="diseno"
                            id="diseno1"
                            value="Cielo Abierto - Fondo Plano"
                            checked
                        />
                        <label class="form-check-label" for="diseno1">
                            Cielo Abierto - Fondo Plano
                        </label>
                    </div>
                </div>

                <div class="col-md-3 design-option">
                    <img
                        src="../product-2.jpg"
                        alt="Big Bag Cielo Abierto - Buz√≥n de Descarga"
                        style="max-width: 9rem; padding: 10px;"
                    />
                    <div class="form-check d-flex">
                        <input
                            class="form-check-input me-2"
                            type="radio"
                            name="diseno"
                            id="diseno2"
                            value="Cielo Abierto - Buz√≥n de Descarga"
                        />
                        <label class="form-check-label" for="diseno2">
                            Cielo Abierto - Buz√≥n de Descarga
                        </label>
                    </div>
                </div>
            </div>
            <br />
            <br />
            <div class="mt-4 d-flex justify-content-start">
                <button
                    type="submit"
                    class="btn-send btn-enviar"
                    id="btnSubmit"
                    
                >
                    Enviar<i class="fa-solid fa-angle-right fa-lg"></i>
                </button>
            </div>
        </form>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Obtenemos los elementos y usamos la aserci√≥n de tipo (as ...)
            // ¬°PERO el tipo base sigue incluyendo 'null'!
            const selectElement = document.getElementById(
                "rucdni_type",
            ) as HTMLSelectElement | null;
            const inputElement = document.getElementById(
                "rucdni_value",
            ) as HTMLInputElement | null;
            const form = document.getElementById(
                "cotizacionForm",
            ) as HTMLFormElement | null;
            const errorElement = document.getElementById(
                "rucdni_error",
            ) as HTMLSpanElement | null;

            // üõë SOLUCI√ìN: Verificamos que todos los elementos cr√≠ticos existan
            if (!selectElement || !inputElement || !form || !errorElement) {
                console.error(
                    "No se pudieron encontrar todos los elementos del formulario (RUC/DNI) en el DOM.",
                );
                // Si falta alguno, detenemos la ejecuci√≥n del script.
                return;
            }

            // --- A PARTIR DE AQU√ç, TypeScript SABE que los elementos existen y NO son null ---

            const telefonoInput =
                document.querySelector<HTMLInputElement>("#telefono");

            if (telefonoInput) {
                telefonoInput.addEventListener("input", () => {
                    telefonoInput.value = telefonoInput.value
                        .replace(/\D/g, "")
                        .slice(0, 9);
                });
            }
            // Funci√≥n de validaci√≥n principal
            function validateRucDni() {
                const type = selectElement!.value; // Ya no hay error de 'possibly null'
                const value = inputElement!.value.trim();

                // Expresiones regulares para la validaci√≥n de formato en Per√∫
                const RUC_REGEX = /^\d{11}$/;
                const DNI_REGEX = /^\d{8}$/;

                errorElement!.textContent = "";
                inputElement!.setCustomValidity("");

                if (!value) {
                    return true;
                }

                if (type === "RUC") {
                    if (!RUC_REGEX.test(value)) {
                        errorElement!.textContent =
                            "El RUC debe tener exactamente 11 d√≠gitos.";
                        inputElement!.setCustomValidity("RUC Inv√°lido");
                        return false;
                    }
                } else if (type === "DNI") {
                    if (!DNI_REGEX.test(value)) {
                        errorElement!.textContent =
                            "El DNI debe tener exactamente 8 d√≠gitos.";
                        inputElement!.setCustomValidity("DNI Inv√°lido");
                        return false;
                    }
                }

                return true;
            }

            // 3. A√±adir Event Listeners (usamos los elementos verificados)

            selectElement.addEventListener("change", validateRucDni);
            inputElement.addEventListener("input", validateRucDni);

            // 4. Prevenir el env√≠o si la validaci√≥n falla
            form.addEventListener("submit", function (event) {
                if (!validateRucDni()) {
                    event.preventDefault();
                    inputElement.focus();
                }
            });
        });
    </script>
</Layout>
<br />
<br />

<Footer />
